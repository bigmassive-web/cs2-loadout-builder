<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS2 Loadout Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #001122);
            color: #ff6600;
            min-height: 100vh;
            padding-top: 80px;
        }

        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(15px);
            border-bottom: 2px solid rgba(0, 191, 255, 0.3);
            z-index: 1000;
            padding: 15px 0;
            box-shadow: 0 5px 20px rgba(0, 191, 255, 0.2);
        }

        .nav-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .nav-menu {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-btn:hover {
            background: rgba(0, 191, 255, 0.2);
            border-color: rgba(0, 191, 255, 0.5);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #9500ff, #00bfff);
            border-color: transparent;
        }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 200px 300px 1fr 200px;
            gap: 30px;
        }

        .ad-space {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            height: 800px;
            position: sticky;
            top: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .ad-space h4 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .ad-placeholder {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 40px 20px;
            flex-grow: 1;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            background: linear-gradient(90deg, #9500ff, #00bfff);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 191, 255, 0.3);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
            color: white;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            color: white;
        }

        .loadout-sidebar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .loadout-sidebar h3 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .loadout-list {
            list-style: none;
            margin-bottom: 20px;
        }

        .loadout-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            color: #ffffff;
        }

        .loadout-item:hover {
            background: rgba(0, 191, 255, 0.1);
            border-left-color: #00bfff;
            transform: translateX(5px);
        }

        .loadout-item.active {
            background: rgba(0, 191, 255, 0.2);
            border-left-color: #00bfff;
        }

        .new-loadout {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #9500ff, #00bfff);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .new-loadout:hover {
            transform: scale(1.05);
        }

        .preview-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 20px;
        }

        .preview-section h3 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .preview-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .preview-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .preview-item h4 {
            color: #ffffff;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .preview-placeholder {
            width: 120px;
            height: 70px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .preview-image {
            width: 120px;
            height: 70px;
            object-fit: contain;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.2);
        }

        .weapons-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .weapon-category {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .weapon-category:hover {
            transform: translateY(-2px);
        }

        .category-title {
            color: #ffffff;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 191, 255, 0.3);
        }

        .weapon-selection-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .weapon-selector {
            min-width: 200px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .weapon-selector option {
            background: #0a0a0a;
            color: white;
        }

        .skin-customization {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .skin-customization.active {
            display: block;
        }

        .skin-search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }

        .skin-search {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            font-size: 14px;
        }

        .skin-search::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .rarity-filter {
            min-width: 150px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            font-size: 14px;
        }

        .rarity-filter option {
            background: #0a0a0a;
            color: white;
        }

        .selected-skin {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 191, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #00bfff;
        }

        .selected-skin h4 {
            color: #ffffff;
            margin-bottom: 5px;
        }

        .selected-skin p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .skin-option {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .skin-option:hover {
            background: rgba(0, 191, 255, 0.1);
            border-left-color: #00bfff;
            transform: translateX(5px);
        }

        .skin-option img {
            width: 60px;
            height: 35px;
            object-fit: contain;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.3);
        }

        .skin-option-info {
            flex: 1;
        }

        .skin-option-name {
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 3px;
        }

        .skin-option-rarity {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .skins-grid {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .weapon-image {
            width: 100%;
            max-width: 250px;
            height: 120px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 15px;
            display: none;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            overflow: hidden;
        }

        .weapon-image.active {
            display: flex;
        }

        .weapon-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 6px;
        }

        .weapon-image-placeholder {
            background: rgba(255, 255, 255, 0.1);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            width: 100%;
            height: 100%;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loadout-actions {
            grid-column: 2 / 4;
            margin-top: 30px;
            text-align: center;
        }

        .action-btn {
            padding: 12px 24px;
            margin: 0 10px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-btn {
            background: linear-gradient(45deg, #00bfff, #0080cc);
            color: white;
        }

        .delete-btn {
            background: linear-gradient(45deg, #ff3333, #cc0000);
            color: white;
        }

        .share-btn {
            background: linear-gradient(45deg, #ffffff, #cccccc);
            color: black;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #0a0a0a, #001122);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 400px;
        }

        .modal input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
        }

        .error-message {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: #ff6b6b;
            display: none;
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 300px 1fr;
                gap: 20px;
            }
            
            .ad-space {
                display: none;
            }
            
            .loadout-actions {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .weapon-selection-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .skin-search-container {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .loadout-sidebar {
                position: static;
            }
        }

        .footer {
            background: linear-gradient(135deg, #0a0a0a, #001122);
            border-top: 2px solid rgba(0, 191, 255, 0.3);
            margin-top: 60px;
            padding: 40px 0 20px;
            color: #ffffff;
        }

        .footer-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .footer-section h4 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 8px;
        }

        .footer-section ul li a {
            color: #cccccc;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-section ul li a:hover {
            color: #00bfff;
        }

        .footer-section p {
            color: #cccccc;
            line-height: 1.6;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
            padding-top: 20px;
            text-align: center;
            color: #888888;
        }

        .footer-bottom a {
            color: #00bfff;
            text-decoration: none;
        }

        .footer-bottom a:hover {
            color: #ffffff;
        }
    </style>
</head>
<body>
    <!-- Top Navigation Bar -->
    <div class="top-nav">
        <div class="nav-content">
            <div class="nav-logo">CS Loadouts</div>
            <div class="nav-menu">
                <a href="https://bigmassive-web.github.io/cs2-loadout-builder/" class="nav-btn active">
                    🔫 Loadout Builder
                </a>
                <a href="https://bigmassive-web.github.io/cs2-loadout-builder/price-game.html" class="nav-btn">
                    💰 Price Game
                </a>
                <a href="https://bigmassive-web.github.io/cs2-loadout-builder/price-guessing.html" class="nav-btn">
                    🎯 Price Guessing
                </a>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="header">
            <h1>CS2 Loadout Builder</h1>
            <p>Create and customize your perfect Counter-Strike 2 weapon loadouts</p>
        </div>

        <!-- Left Ad Space -->
        <div class="ad-space">
            <h4>Advertisement</h4>
            <div class="ad-placeholder">
                <div>Advertisement Space</div>
                <div>300x800</div>
            </div>
        </div>

        <div class="loadout-sidebar">
            <h3>My Loadouts</h3>
            <ul class="loadout-list" id="loadoutList">
                <li class="loadout-item active" data-loadout="0">Default Loadout</li>
            </ul>
            <button class="new-loadout" onclick="createNewLoadout()">+ New Loadout</button>
            
            <div class="preview-section">
                <h3>Preview</h3>
                <div class="preview-grid">
                    <div class="preview-item">
                        <h4>Glove + Knife</h4>
                        <div class="preview-placeholder" id="preview-glove-knife">No items</div>
                    </div>
                    <div class="preview-item">
                        <h4>Rifle + Glove</h4>
                        <div class="preview-placeholder" id="preview-rifle-glove">No items</div>
                    </div>
                    <div class="preview-item">
                        <h4>Pistol + Glove</h4>
                        <div class="preview-placeholder" id="preview-pistol-glove">No items</div>
                    </div>
                    <div class="preview-item">
                        <h4>SMG + Glove</h4>
                        <div class="preview-placeholder" id="preview-smg-glove">No items</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="weapons-container" id="weaponsContainer">
            <div class="error-message" id="errorMessage">
                <h3>Unable to load CS2 data</h3>
                <p>Please check your internet connection and refresh the page.</p>
            </div>
        </div>

        <!-- Right Ad Space -->
        <div class="ad-space">
            <h4>Advertisement</h4>
            <div class="ad-placeholder">
                <div>Advertisement Space</div>
                <div>300x800</div>
            </div>
        </div>

        <div class="loadout-actions">
            <button class="action-btn save-btn" onclick="saveCurrentLoadout()">Save Loadout</button>
            <button class="action-btn share-btn" onclick="shareLoadout()">Share Loadout</button>
            <button class="action-btn delete-btn" onclick="deleteCurrentLoadout()">Delete Loadout</button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>CS Loadouts</h4>
                <p>The ultimate destination for Counter-Strike 2 loadout creation and customization. Build your perfect weapon configurations and share them with the community.</p>
            </div>
            
            <div class="footer-section">
                <h4>Available Tools</h4>
                <ul>
                    <li><a href="https://bigmassive-web.github.io/cs2-loadout-builder/">Loadout Builder</a></li>
                    <li><a href="https://bigmassive-web.github.io/cs2-loadout-builder/price-game.html">Price Game</a></li>
                    <li><a href="https://bigmassive-web.github.io/cs2-loadout-builder/price-guessing.html">Price Guessing</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h4>Coming Soon</h4>
                <ul>
                    <li>Skin Calculator</li>
                    <li>Trade Tracker</li>
                    <li>CS2 News Feed</li>
                    <li>Weapon Guides</li>
                    <li>Market Trends Analysis</li>
                    <li>Pro Player Loadouts</li>
                    <li>Skin Database</li>
                </ul>
                <p style="color: #ffffff; font-weight: bold; margin-top: 15px;">More exciting features in development!</p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>Not affiliated with Valve Corporation or Counter-Strike. All game assets are property of their respective owners.</p>
        </div>
    </footer>

    <!-- Modal for creating new loadout -->
    <div class="modal" id="newLoadoutModal">
        <div class="modal-content">
            <h3 style="color: #ffffff; margin-bottom: 20px;">Create New Loadout</h3>
            <input type="text" id="loadoutName" placeholder="Enter loadout name..." maxlength="30">
            <div style="margin-top: 20px;">
                <button class="action-btn save-btn" onclick="confirmNewLoadout()">Create</button>
                <button class="action-btn delete-btn" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let loadouts = [
            {
                id: 0,
                name: "Default Loadout",
                weapons: {}
            }
        ];
        let currentLoadoutId = 0;
        let nextLoadoutId = 1;
        let apiData = {
            skins: [],
            gloves: []
        };
        let currentWeaponSkins = {};
        let allRarities = new Set();

        // API Configuration
        const API_ENDPOINTS = {
            primary: 'https://bymykel.github.io/CSGO-API/api/en/',
            github_raw: 'https://raw.githubusercontent.com/ByMykel/CSGO-API/main/public/api/en/',
            cors_proxies: [
                'https://api.allorigins.win/raw?url=',
                'https://corsproxy.io/?',
                'https://cors-anywhere.herokuapp.com/',
                'https://api.codetabs.com/v1/proxy?quest='
            ]
        };
        
        // Weapon category mappings
        const WEAPON_CATEGORIES = {
            knives: ['Karambit', 'M9 Bayonet', 'Bayonet', 'Flip Knife', 'Gut Knife', 'Falchion Knife', 'Bowie Knife', 'Butterfly Knife', 'Huntsman Knife', 'Shadow Daggers', 'Ursus Knife', 'Navaja Knife', 'Stiletto Knife', 'Talon Knife', 'Classic Knife', 'Paracord Knife', 'Survival Knife', 'Nomad Knife', 'Skeleton Knife', 'Kukri Knife'],
            rifles: ['AK-47', 'M4A4', 'M4A1-S', 'AWP', 'SSG 08', 'AUG', 'SG 553', 'FAMAS', 'Galil AR', 'SCAR-20', 'G3SG1'],
            pistols: ['Glock-18', 'USP-S', 'P2000', 'Desert Eagle', 'P250', 'Tec-9', 'Five-SeveN', 'CZ75-Auto', 'R8 Revolver', 'Dual Berettas'],
            smgs: ['MP7', 'MP9', 'MP5-SD', 'UMP-45', 'P90', 'PP-Bizon', 'MAC-10'],
            gloves: ['Sport Gloves', 'Driver Gloves', 'Hand Wraps', 'Moto Gloves', 'Specialist Gloves', 'Bloodhound Gloves', 'Broken Fang Gloves', 'Hydra Gloves']
        };

        // Initialize the application
        async function initializeApp() {
            try {
                // Always create the weapon categories first, regardless of API status
                createWeaponCategories();
                updateLoadoutList();
                
                // Test API connectivity first
                console.log('Testing API connectivity...');
                await testAPIConnectivity();
                
                // Try to load API data
                try {
                    await loadAPIData();
                    populateWeaponSelectors();
                    populateRarityFilters();
                    showNotification('Successfully loaded all CS2 skins!', 'success');
                } catch (apiError) {
                    console.log('API failed, creating basic weapon selectors...');
                    populateBasicWeaponSelectors();
                    showNotification('CS2 API temporarily unavailable. Basic interface loaded.', 'warning');
                }
            } catch (error) {
                console.error('Error initializing app:', error);
                // Even if everything fails, still show the interface
                createWeaponCategories();
                populateBasicWeaponSelectors();
                updateLoadoutList();
                showNotification('Interface loaded in offline mode.', 'warning');
            }
        }

        // Test API connectivity
        async function testAPIConnectivity() {
            const testUrls = [
                'https://bymykel.github.io/CSGO-API/api/en/skins.json',
                'https://raw.githubusercontent.com/ByMykel/CSGO-API/main/public/api/en/skins.json',
                'https://api.allorigins.win/get?url=' + encodeURIComponent('https://bymykel.github.io/CSGO-API/api/en/skins.json')
            ];
            
            for (let i = 0; i < testUrls.length; i++) {
                try {
                    console.log(`Testing URL ${i + 1}: ${testUrls[i]}`);
                    const response = await fetch(testUrls[i], { 
                        method: 'HEAD',
                        mode: 'cors'
                    });
                    console.log(`URL ${i + 1} status:`, response.status, response.statusText);
                    if (response.ok) {
                        console.log(`✅ URL ${i + 1} is accessible`);
                        return;
                    }
                } catch (error) {
                    console.log(`❌ URL ${i + 1} failed:`, error.message);
                }
            }
            console.log('⚠️ No API endpoints are accessible');
        }

        // Load data from ByMykel API
        async function loadAPIData() {
            console.log('Loading CS2 data from ByMykel API...');
            
            let skinsData = null;
            let glovesData = null;
            
            // Try direct API access first
            try {
                console.log('Attempting direct API access...');
                const [skinsResponse, glovesResponse] = await Promise.all([
                    fetch(`${API_ENDPOINTS.primary}skins_not_grouped.json`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                        },
                        mode: 'cors'
                    }),
                    fetch(`${API_ENDPOINTS.primary}gloves.json`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                        },
                        mode: 'cors'
                    })
                ]);
                
                console.log('Skins response status:', skinsResponse.status);
                console.log('Gloves response status:', glovesResponse.status);
                
                if (skinsResponse.ok && glovesResponse.ok) {
                    skinsData = await skinsResponse.json();
                    glovesData = await glovesResponse.json();
                    console.log('✅ Direct API access successful');
                    console.log('Loaded skins:', skinsData.length);
                    console.log('Loaded gloves:', glovesData.length);
                }
            } catch (error) {
                console.log('❌ Direct API access failed:', error.message);
            }
            
            // Try GitHub raw if direct failed
            if (!skinsData || !glovesData) {
                try {
                    console.log('Attempting GitHub raw access...');
                    const [skinsResponse, glovesResponse] = await Promise.all([
                        fetch(`${API_ENDPOINTS.github_raw}skins_not_grouped.json`, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                            }
                        }),
                        fetch(`${API_ENDPOINTS.github_raw}gloves.json`, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                            }
                        })
                    ]);
                    
                    console.log('GitHub Skins response status:', skinsResponse.status);
                    console.log('GitHub Gloves response status:', glovesResponse.status);
                    
                    if (skinsResponse.ok && glovesResponse.ok) {
                        skinsData = await skinsResponse.json();
                        glovesData = await glovesResponse.json();
                        console.log('✅ GitHub raw access successful');
                        console.log('Loaded skins:', skinsData.length);
                        console.log('Loaded gloves:', glovesData.length);
                    }
                } catch (error) {
                    console.log('❌ GitHub raw access failed:', error.message);
                }
            }
            
            // Try simplified CORS proxy
            if (!skinsData || !glovesData) {
                try {
                    console.log('Attempting simple CORS proxy...');
                    const proxy = 'https://api.allorigins.win/get?url=';
                    
                    const [skinsResponse, glovesResponse] = await Promise.all([
                        fetch(`${proxy}${encodeURIComponent(API_ENDPOINTS.primary + 'skins_not_grouped.json')}`),
                        fetch(`${proxy}${encodeURIComponent(API_ENDPOINTS.primary + 'gloves.json')}`)
                    ]);
                    
                    if (skinsResponse.ok && glovesResponse.ok) {
                        const skinsData_raw = await skinsResponse.json();
                        const glovesData_raw = await glovesResponse.json();
                        
                        // Parse the contents from AllOrigins format
                        skinsData = JSON.parse(skinsData_raw.contents);
                        glovesData = JSON.parse(glovesData_raw.contents);
                        
                        console.log('✅ CORS proxy access successful');
                        console.log('Loaded skins:', skinsData.length);
                        console.log('Loaded gloves:', glovesData.length);
                    }
                } catch (error) {
                    console.log('❌ CORS proxy failed:', error.message);
                }
            }
            
            // Try alternative endpoint structure
            if (!skinsData || !glovesData) {
                try {
                    console.log('Attempting alternative endpoint...');
                    const altBase = 'https://raw.githubusercontent.com/ByMykel/CSGO-API/main/public/api/en/';
                    
                    const [skinsResponse, glovesResponse] = await Promise.all([
                        fetch(`${altBase}skins.json`), // Try regular skins instead of not_grouped
                        fetch(`${altBase}gloves.json`)
                    ]);
                    
                    console.log('Alt Skins response status:', skinsResponse.status);
                    console.log('Alt Gloves response status:', glovesResponse.status);
                    
                    if (skinsResponse.ok && glovesResponse.ok) {
                        skinsData = await skinsResponse.json();
                        glovesData = await glovesResponse.json();
                        console.log('✅ Alternative endpoint successful');
                        console.log('Loaded skins:', skinsData.length);
                        console.log('Loaded gloves:', glovesData.length);
                    }
                } catch (error) {
                    console.log('❌ Alternative endpoint failed:', error.message);
                }
            }
            
            if (!skinsData || !glovesData) {
                console.log('❌ All API methods failed');
                throw new Error('Unable to load CS2 data from any source');
            }
            
            apiData.skins = skinsData;
            apiData.gloves = glovesData;
            
            console.log(`📊 Successfully loaded ${apiData.skins.length} skins and ${apiData.gloves.length} gloves`);
            
            // Extract all rarities for filters
            [...apiData.skins, ...apiData.gloves].forEach(item => {
                if (item.rarity && item.rarity.name) {
                    allRarities.add(item.rarity.name);
                }
            });
        }

        // Create weapon category sections
        function createWeaponCategories() {
            const container = document.getElementById('weaponsContainer');
            if (!container) {
                console.error('Weapons container not found!');
                return;
            }
            
            const errorMessage = document.getElementById('errorMessage');
            if (errorMessage) {
                errorMessage.style.display = 'none';
            }
            
            // Clear any existing content
            container.innerHTML = '';
            
            Object.keys(WEAPON_CATEGORIES).forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'weapon-category';
                
                const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
                let selectPrompt = '';
                if (category === 'gloves') {
                    selectPrompt = 'Select gloves...';
                } else if (category === 'knives') {
                    selectPrompt = 'Select a knife...';
                } else {
                    selectPrompt = `Select a ${category.slice(0, -1)}...`;
                }
                
                let selectedPrompt = '';
                if (category === 'gloves') {
                    selectedPrompt = 'No gloves selected';
                } else if (category === 'knives') {
                    selectedPrompt = 'No knife selected';
                } else {
                    selectedPrompt = `No ${category.slice(0, -1)} selected`;
                }
                
                let choosePrompt = '';
                if (category === 'gloves') {
                    choosePrompt = 'Choose gloves and skin from the options above';
                } else if (category === 'knives') {
                    choosePrompt = 'Choose a knife and skin from the options above';
                } else {
                    choosePrompt = `Choose a ${category.slice(0, -1)} and skin from the options above`;
                }
                
                categoryDiv.innerHTML = `
                    <h3 class="category-title">${categoryName}</h3>
                    <div class="weapon-selection-container">
                        <select class="weapon-selector" data-category="${category}">
                            <option value="">${selectPrompt}</option>
                        </select>
                    </div>
                    <div class="skin-customization" id="${category}-customization">
                        <div class="skin-search-container">
                            <input type="text" class="skin-search" placeholder="Search skins...">
                            <select class="rarity-filter">
                                <option value="">All Rarities</option>
                            </select>
                        </div>
                        <div class="selected-skin" id="${category}-selected">
                            <h4>${selectedPrompt}</h4>
                            <p>${choosePrompt}</p>
                        </div>
                        <div class="weapon-image" id="${category}-image">
                            <div class="weapon-image-placeholder">
                                <div>Weapon Image</div>
                                <div style="font-size: 0.6rem;">Will appear when selected</div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(categoryDiv);
                
                // Add event listeners
                const selector = categoryDiv.querySelector('.weapon-selector');
                const searchInput = categoryDiv.querySelector('.skin-search');
                const rarityFilter = categoryDiv.querySelector('.rarity-filter');
                
                if (selector) {
                    selector.addEventListener('change', function() {
                        showSkinCustomization(this);
                    });
                }
                
                if (searchInput) {
                    searchInput.addEventListener('input', function() {
                        filterSkins(this);
                    });
                }
                
                if (rarityFilter) {
                    rarityFilter.addEventListener('change', function() {
                        filterByRarity(this);
                    });
                }
            });
            
            console.log('Weapon categories created successfully');
        }

        // Populate weapon selector dropdowns with basic weapon names when API fails
        function populateBasicWeaponSelectors() {
            Object.keys(WEAPON_CATEGORIES).forEach(category => {
                const selector = document.querySelector(`[data-category="${category}"]`);
                if (!selector) return;
                
                // Use predefined weapon lists for all categories
                WEAPON_CATEGORIES[category].forEach(weaponName => {
                    const option = document.createElement('option');
                    option.value = weaponName;
                    option.textContent = weaponName;
                    selector.appendChild(option);
                });
            });
        }

        // Populate weapon selector dropdowns with API data
        function populateWeaponSelectors() {
            Object.keys(WEAPON_CATEGORIES).forEach(category => {
                const selector = document.querySelector(`[data-category="${category}"]`);
                if (!selector) return;
                
                if (category === 'gloves') {
                    // For gloves, get unique glove types from API data
                    const gloveTypes = [...new Set(apiData.gloves.map(glove => glove.weapon.name))].sort();
                    gloveTypes.forEach(gloveType => {
                        const option = document.createElement('option');
                        option.value = gloveType;
                        option.textContent = gloveType;
                        selector.appendChild(option);
                    });
                } else {
                    // For other categories, use predefined weapon lists
                    WEAPON_CATEGORIES[category].forEach(weaponName => {
                        const option = document.createElement('option');
                        option.value = weaponName;
                        option.textContent = weaponName;
                        selector.appendChild(option);
                    });
                }
            });
        }

        // Populate rarity filter dropdowns
        function populateRarityFilters() {
            const rarityFilters = document.querySelectorAll('.rarity-filter');
            const sortedRarities = Array.from(allRarities).sort();
            
            rarityFilters.forEach(filter => {
                sortedRarities.forEach(rarity => {
                    const option = document.createElement('option');
                    option.value = rarity;
                    option.textContent = rarity;
                    filter.appendChild(option);
                });
            });
        }

        // Show skin customization panel
        function showSkinCustomization(selector) {
            const category = selector.dataset.category;
            const weapon = selector.value;
            const customization = document.getElementById(`${category}-customization`);
            
            if (weapon) {
                customization.classList.add('active');
                
                // If we have API data, use it. Otherwise show placeholder message
                if (apiData.skins.length > 0 || apiData.gloves.length > 0) {
                    updateSkinOptions(category, weapon);
                } else {
                    showPlaceholderSkins(category, weapon);
                }
            } else {
                customization.classList.remove('active');
            }
        }

        // Show placeholder when API data is not available
        function showPlaceholderSkins(category, weapon) {
            const selectedDiv = document.getElementById(`${category}-selected`);
            selectedDiv.innerHTML = `
                <h4>CS2 API Unavailable</h4>
                <p>Selected: ${weapon}</p>
                <p style="color: rgba(255, 255, 255, 0.7); margin-top: 10px;">
                    Deploy this site to your website to load real CS2 skins and images from the ByMykel API.
                </p>
                <div style="margin-top: 15px; padding: 10px; background: rgba(0, 191, 255, 0.1); border-radius: 5px; border-left: 3px solid #00bfff;">
                    <strong>Demo Mode:</strong> All features work, but real CS2 data requires deployment.
                </div>
            `;
        }

        // Update skin options based on selected weapon
        function updateSkinOptions(category, weapon) {
            let skins = [];
            
            if (category === 'gloves' && apiData.gloves.length > 0) {
                skins = apiData.gloves.filter(glove => glove.weapon.name === weapon);
            } else if (apiData.skins.length > 0) {
                skins = apiData.skins.filter(skin => skin.weapon.name === weapon);
            }
            
            currentWeaponSkins[category] = skins;
            
            // Reset filters
            const searchInput = document.querySelector(`#${category}-customization .skin-search`);
            const rarityFilter = document.querySelector(`#${category}-customization .rarity-filter`);
            if (searchInput) searchInput.value = '';
            if (rarityFilter) rarityFilter.value = '';
            
            displaySkins(category, skins);
        }

        // Display skins in the customization panel
        function displaySkins(category, skins) {
            const selectedDiv = document.getElementById(`${category}-selected`);
            
            if (skins.length === 0) {
                // Check if this is because API failed or genuinely no skins
                if (apiData.skins.length === 0 && apiData.gloves.length === 0) {
                    const weaponSelector = document.querySelector(`[data-category="${category}"]`);
                    const selectedWeapon = weaponSelector ? weaponSelector.value : 'Unknown';
                    selectedDiv.innerHTML = `
                        <h4>API Demo Mode</h4>
                        <p>Weapon: ${selectedWeapon}</p>
                        <p style="color: rgba(255, 255, 255, 0.7);">
                            Real CS2 skins will load when deployed to your website.
                        </p>
                    `;
                } else {
                    selectedDiv.innerHTML = `
                        <h4>No skins available</h4>
                        <p>No skins found for this weapon</p>
                    `;
                }
                return;
            }

            // Show up to 100 skins for better browsing
            const skinsToShow = skins.slice(0, 100);
            
            let skinsHtml = `
                <h4>Available Skins (${skins.length} total${skins.length > 100 ? ', showing first 100' : ''})</h4>
                <div class="skins-grid">
            `;
            
            skinsToShow.forEach(skin => {
                const rarityClass = skin.rarity ? skin.rarity.id.replace('rarity_', '').replace('_weapon', '').replace('_character', '') : 'consumer';
                const rarityName = skin.rarity ? skin.rarity.name : 'Consumer Grade';
                const rarityColor = skin.rarity ? skin.rarity.color : '#b0c3d9';
                const safeName = skin.name.replace(/'/g, "\\'").replace(/"/g, '\\"');
                
                skinsHtml += `
                    <div class="skin-option rarity-${rarityClass}" 
                         style="border-left-color: ${rarityColor};"
                         onclick="selectSkin('${category}', '${skin.id}', '${safeName}', '${rarityName}', '${skin.image}', '${skin.weapon.name}')">
                        <img src="${skin.image}" alt="${skin.name}" 
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iMzUiIHZpZXdCb3g9IjAgMCA2MCAzNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjM1IiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjMwIiB5PSIxOCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjgiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4='" />
                        <div class="skin-option-info">
                            <div class="skin-option-name">${skin.name}</div>
                            <div class="skin-option-rarity" style="color: ${rarityColor};">${rarityName}</div>
                        </div>
                    </div>
                `;
            });
            
            if (skins.length > 100) {
                skinsHtml += `
                    <div style="text-align: center; padding: 15px; color: rgba(255, 255, 255, 0.7); font-style: italic;">
                        Showing first 100 of ${skins.length} skins. Use search/filter to narrow results.
                    </div>
                `;
            }
            
            skinsHtml += '</div>';
            selectedDiv.innerHTML = skinsHtml;
        }

        // Select a specific skin
        function selectSkin(category, skinId, skinName, rarity, imageUrl, weaponName) {
            const selectedDiv = document.getElementById(`${category}-selected`);
            const imageDiv = document.getElementById(`${category}-image`);
            
            // Update selected skin display
            selectedDiv.innerHTML = `
                <h4>${skinName}</h4>
                <p>Weapon: ${weaponName} | Rarity: ${rarity}</p>
            `;
            
            // Show weapon image
            imageDiv.classList.add('active');
            imageDiv.innerHTML = `<img src="${imageUrl}" alt="${skinName}" />`;
            
            // Save to current loadout
            saveWeaponSelection(category, skinId, skinName, rarity, imageUrl, weaponName);
            
            // Update preview combinations
            updatePreviewCombinations();
        }

        // Filter skins based on search input
        function filterSkins(searchInput) {
            const category = searchInput.closest('.skin-customization').id.replace('-customization', '');
            const searchTerm = searchInput.value.toLowerCase();
            const rarityFilter = searchInput.closest('.skin-customization').querySelector('.rarity-filter');
            const selectedRarity = rarityFilter.value;
            
            if (!currentWeaponSkins[category]) return;
            
            let filteredSkins = currentWeaponSkins[category];
            
            // Filter by search term
            if (searchTerm) {
                filteredSkins = filteredSkins.filter(skin => 
                    skin.name.toLowerCase().includes(searchTerm)
                );
            }
            
            // Filter by rarity
            if (selectedRarity) {
                filteredSkins = filteredSkins.filter(skin => 
                    skin.rarity && skin.rarity.name === selectedRarity
                );
            }
            
            displaySkins(category, filteredSkins);
        }

        // Filter skins by rarity
        function filterByRarity(rarityFilter) {
            const category = rarityFilter.closest('.skin-customization').id.replace('-customization', '');
            const selectedRarity = rarityFilter.value;
            const searchInput = rarityFilter.closest('.skin-customization').querySelector('.skin-search');
            const searchTerm = searchInput.value.toLowerCase();
            
            if (!currentWeaponSkins[category]) return;
            
            let filteredSkins = currentWeaponSkins[category];
            
            // Filter by rarity
            if (selectedRarity) {
                filteredSkins = filteredSkins.filter(skin => 
                    skin.rarity && skin.rarity.name === selectedRarity
                );
            }
            
            // Filter by search term
            if (searchTerm) {
                filteredSkins = filteredSkins.filter(skin => 
                    skin.name.toLowerCase().includes(searchTerm)
                );
            }
            
            displaySkins(category, filteredSkins);
        }

        // Save weapon selection to current loadout
        function saveWeaponSelection(category, skinId, skinName, rarity, imageUrl, weaponName) {
            const currentLoadout = loadouts.find(l => l.id === currentLoadoutId);
            if (!currentLoadout.weapons[category]) {
                currentLoadout.weapons[category] = {};
            }
            currentLoadout.weapons[category] = {
                skinId: skinId,
                weapon: weaponName,
                skin: skinName,
                rarity: rarity,
                image: imageUrl
            };
        }

        // Update preview combinations
        function updatePreviewCombinations() {
            const currentLoadout = loadouts.find(l => l.id === currentLoadoutId);
            const weapons = currentLoadout.weapons;
            
            // Get selected items
            const glove = weapons.gloves;
            const knife = weapons.knives;
            const rifle = weapons.rifles;
            const pistol = weapons.pistols;
            const smg = weapons.smgs;
            
            // Update preview combinations
            updatePreviewItem('preview-glove-knife', glove, knife);
            updatePreviewItem('preview-rifle-glove', rifle, glove);
            updatePreviewItem('preview-pistol-glove', pistol, glove);
            updatePreviewItem('preview-smg-glove', smg, glove);
        }

        // Update individual preview item
        function updatePreviewItem(elementId, item1, item2) {
            const element = document.getElementById(elementId);
            
            if (item1 && item2) {
                const item1Name = `${item1.weapon} | ${item1.skin}`;
                const item2Name = `${item2.weapon} | ${item2.skin}`;
                element.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                        <img src="${item1.image}" alt="${item1Name}" class="preview-image" />
                        <img src="${item2.image}" alt="${item2Name}" class="preview-image" />
                    </div>
                `;
                element.style.background = 'rgba(0, 191, 255, 0.1)';
                element.style.borderColor = 'rgba(0, 191, 255, 0.3)';
            } else if (item1 || item2) {
                const item = item1 || item2;
                const itemName = `${item.weapon} | ${item.skin}`;
                element.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                        <img src="${item.image}" alt="${itemName}" class="preview-image" />
                        <div style="font-size: 0.6rem; text-align: center;">+ Missing item</div>
                    </div>
                `;
                element.style.background = 'rgba(255, 255, 255, 0.1)';
                element.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            } else {
                element.innerHTML = '<div style="font-size: 0.7rem;">No items</div>';
                element.style.background = 'rgba(255, 255, 255, 0.1)';
                element.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            }
        }

        // Show error message
        function showErrorMessage() {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.style.display = 'block';
        }

        // Loadout management functions
        function saveCurrentLoadout() {
            showNotification('Loadout saved successfully!', 'success');
        }

        function loadLoadout(loadoutId) {
            const loadout = loadouts.find(l => l.id === loadoutId);
            if (!loadout) return;

            currentLoadoutId = loadoutId;
            
            // Update UI to show active loadout
            document.querySelectorAll('.loadout-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.loadout) === loadoutId) {
                    item.classList.add('active');
                }
            });

            // Load weapon selections
            Object.keys(loadout.weapons).forEach(category => {
                const weaponData = loadout.weapons[category];
                if (weaponData) {
                    const selector = document.querySelector(`[data-category="${category}"]`);
                    if (selector) {
                        selector.value = weaponData.weapon;
                        showSkinCustomization(selector);
                        
                        // Wait a bit for the skin options to load, then select the skin
                        setTimeout(() => {
                            selectSkin(category, weaponData.skinId, weaponData.skin, weaponData.rarity, weaponData.image, weaponData.weapon);
                        }, 100);
                    }
                }
            });
            
            // Update preview after loading
            setTimeout(() => {
                updatePreviewCombinations();
            }, 200);
        }

        function createNewLoadout() {
            document.getElementById('newLoadoutModal').style.display = 'block';
            document.getElementById('loadoutName').focus();
        }

        function confirmNewLoadout() {
            const name = document.getElementById('loadoutName').value.trim();
            if (!name) {
                showNotification('Please enter a loadout name', 'error');
                return;
            }

            const newLoadout = {
                id: nextLoadoutId++,
                name: name,
                weapons: {}
            };

            loadouts.push(newLoadout);
            updateLoadoutList();
            loadLoadout(newLoadout.id);
            closeModal();
            showNotification('New loadout created!', 'success');
        }

        function deleteCurrentLoadout() {
            if (loadouts.length <= 1) {
                showNotification('Cannot delete the last loadout', 'error');
                return;
            }

            if (confirm('Are you sure you want to delete this loadout?')) {
                loadouts = loadouts.filter(l => l.id !== currentLoadoutId);
                updateLoadoutList();
                loadLoadout(loadouts[0].id);
                showNotification('Loadout deleted', 'success');
            }
        }

        function shareLoadout() {
            const currentLoadout = loadouts.find(l => l.id === currentLoadoutId);
            const loadoutData = JSON.stringify(currentLoadout, null, 2);
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(loadoutData).then(() => {
                    showNotification('Loadout copied to clipboard!', 'success');
                });
            } else {
                // Fallback for older browsers
                prompt('Copy this loadout data:', loadoutData);
            }
        }

        function updateLoadoutList() {
            const list = document.getElementById('loadoutList');
            list.innerHTML = '';
            
            loadouts.forEach(loadout => {
                const item = document.createElement('li');
                item.className = `loadout-item ${loadout.id === currentLoadoutId ? 'active' : ''}`;
                item.dataset.loadout = loadout.id;
                item.textContent = loadout.name;
                item.onclick = () => loadLoadout(loadout.id);
                list.appendChild(item);
            });
        }

        function closeModal() {
            document.getElementById('newLoadoutModal').style.display = 'none';
            document.getElementById('loadoutName').value = '';
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'linear-gradient(45deg, #28a745, #20c997)' : 
                            type === 'warning' ? 'linear-gradient(45deg, #ffc107, #fd7e14)' :
                            'linear-gradient(45deg, #dc3545, #e74c3c)';
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                background: ${bgColor};
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Add animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
